#!/usr/bin/env ruby
require "fileutils"

APP_ROOT = File.expand_path("..", __dir__)

def system!(*args)
  system(*args, exception: true)
end

def check_docker
  unless system("docker --version > /dev/null 2>&1")
    abort "âŒ Docker is not installed. Please install Docker Desktop first."
  end
  
  unless system("docker-compose --version > /dev/null 2>&1")
    abort "âŒ Docker Compose is not installed. Please install Docker Compose first."
  end
end

FileUtils.chdir APP_ROOT do
  puts "ğŸ³ Setting up Speedrail with Docker..."
  
  check_docker
  
  puts "\nğŸ“¦ Building Docker images..."
  system! "docker-compose build"
  
  puts "\nğŸ—„ï¸  Setting up database..."
  system! "docker-compose run --rm web bundle exec rails db:create db:migrate db:seed"
  
  puts "\nâœ… Setup complete!"
  puts "\nğŸš€ To start the application:"
  puts "   docker-compose up"
  puts "\nğŸŒ Application will be available at: http://localhost:3000"
  puts "\nğŸ“Š Admin panel: http://localhost:3000/admin"
  puts "\nğŸ›‘ To stop: docker-compose down"
end
